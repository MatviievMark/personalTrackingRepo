<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Finance Tracker</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }

      h1 {
        margin-bottom: 20px;
      }

      form {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 5px;
      }

      input[type="number"],
      input[type="date"],
      input[type="text"] {
        width: 200px;
        padding: 5px;
        margin-bottom: 10px;
      }

      button {
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        border: none;
        cursor: pointer;
      }

      #message {
        margin-top: 20px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>Personal Finance Tracker</h1>

    <form id="transactionForm">
      <label for="amount">Amount:</label>
      <input type="number" id="amount" name="amount" required>

      <label for="date">Date:</label>
      <input type="date" id="date" name="date" required>

      <label for="category">Category:</label>
      <input type="text" id="category" name="category" required>

      <label for="description">Description:</label>
      <input type="text" id="description" name="description" required>

      <button type="submit">Add Transaction</button>
    </form>

    <div id="message"></div>

    <div id="transactions">
      <h2>Transactions</h2> 
      <table>
        <thead>
          <tr>
            <th>Amount</th>
            <th>Date</th>
            <th>Category</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody id="transactionsTable">
          <!-- Transactions will be added here -->
        </tbody>
      </table>
    </div>

    <script>
      const form = document.getElementById('transactionForm');
      const messageDiv = document.getElementById('message');
      // const transactionsTable = document.getElementById('transactionsTable');

      form.addEventListener('submit', async (event) => {
        event.preventDefault();

        const amount = document.getElementById('amount').value;
        const date = document.getElementById('date').value;
        const category = document.getElementById('category').value;
        const description = document.getElementById('description').value;

        try {
          const response = await fetch('/transactions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ amount, date, category, description })
          });

          if (response.ok) {
            messageDiv.textContent = 'Transaction added successfully!';
            form.reset();
          } else {
            messageDiv.textContent = 'Failed to add transaction.';
          }
        } catch (error) {
          console.error('Error:', error);
          messageDiv.textContent = 'An error occurred.';
        }
      });
      
      // // Fetch transactions when the page loads
      async function fetchAndDisplayTransactions() {
      try {
        const response = await fetch('/transactions');
        const transactions = await response.json();

          transactionsTable.innerHTML = '';
          transactions.forEach((transaction) => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${transaction.amount}</td>
              <td>${transaction.date}</td>
              <td>${transaction.category}</td>
              <td>${transaction.description}</td>
            `;
            transactionsTable.appendChild(row);
          });
        } catch (error) {
          console.error('Error fetching transactions:', error);
          messageDiv.textContent = 'An error occurred while fetching transactions.';
        }
      }

      // Call the fetchAndDisplayTransactions function when the page loads
      window.addEventListener('load', fetchAndDisplayTransactions);
    </script>
  </body>
</html>